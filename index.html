<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>H√ºseyin Akdaƒü ƒ∞lkokulu Fen Bilimleri 4. Tema Yarƒ±≈ümasƒ±</title>

  <style>
    :root{
      --bg0:#060314;
      --bg1:#0a0830;

      --panel: rgba(6,6,18,.72);

      /* Mor-Mavi Neon */
      --blue:#43b7ff;
      --purple:#b45cff;
      --pink:#ff4fd8;

      --text:#f4f8ff;
      --muted:#b7bce8;

      --good:#22c55e;
      --bad:#ef4444;

      --radius:22px;
      --shadow: 0 30px 90px rgba(0,0,0,.62);

      --glowBlue: 0 0 18px rgba(67,183,255,.22), 0 0 46px rgba(67,183,255,.12);
      --glowBlueStrong: 0 0 24px rgba(67,183,255,.32), 0 0 70px rgba(67,183,255,.18);
      --glowPurple: 0 0 18px rgba(180,92,255,.22), 0 0 46px rgba(180,92,255,.12);

      /* Arka plan g√∂rseli */
      --bgImg: none;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);

      /* G√∂rsel + gradient katmanlar */
      background-image:
        linear-gradient(180deg, rgba(6,3,20,.78), rgba(10,8,48,.74)),
        var(--bgImg);
      background-size: cover, cover;
      background-position: center, center;
      background-attachment: fixed, fixed;

      /* Neon ƒ±≈üƒ±klar √ºstte */
      background-color: #07051a;
      background-blend-mode: normal;

      min-height:100vh;
      overflow-x:hidden;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    /* Body neon ƒ±≈üƒ±k parƒ±ltƒ±larƒ± */
    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(1100px 700px at 18% 18%, rgba(180,92,255,.18), transparent 55%),
        radial-gradient(1000px 650px at 85% 22%, rgba(67,183,255,.22), transparent 55%),
        radial-gradient(1200px 900px at 50% 92%, rgba(255,79,216,.08), transparent 62%);
      z-index:-1;
    }

    .wrap{ max-width:1200px; margin:0 auto; padding:18px 14px 24px; }

    /* ===== Neon Frame ===== */
    .neonFrame{
      position:relative;
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(8,7,22,.78), rgba(8,7,22,.58));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .neonFrame::before{
      content:"";
      position:absolute; inset:-2px;
      background: conic-gradient(from 200deg,
        rgba(67,183,255,.0),
        rgba(67,183,255,.88),
        rgba(180,92,255,.88),
        rgba(255,79,216,.55),
        rgba(67,183,255,.88),
        rgba(67,183,255,.0)
      );
      filter: blur(8px);
      opacity:.90;
      z-index:0;
    }
    .neonFrame::after{
      content:"";
      position:absolute; inset:1px;
      border-radius: calc(var(--radius) - 2px);
      background:
        radial-gradient(900px 500px at 22% 0%, rgba(67,183,255,.10), transparent 60%),
        radial-gradient(900px 500px at 85% 10%, rgba(180,92,255,.12), transparent 60%),
        linear-gradient(180deg, rgba(8,7,22,.82), rgba(8,7,22,.58));
      z-index:0;
    }
    .content{ position:relative; z-index:1; padding:14px; }

    /* Skor tablosu paneline √∂zel: mavi parlak neon + g√∂rsel dokusu */
    .lbFrame::before{
      opacity:1;
      filter: blur(9px);
      background: conic-gradient(from 220deg,
        rgba(67,183,255,.0),
        rgba(67,183,255,.95),
        rgba(67,183,255,.65),
        rgba(67,183,255,.95),
        rgba(67,183,255,.0)
      );
    }
    .lbFrame::after{
      background:
        linear-gradient(180deg, rgba(6,3,20,.72), rgba(10,8,48,.62)),
        radial-gradient(900px 520px at 30% 0%, rgba(67,183,255,.16), transparent 60%),
        radial-gradient(900px 520px at 85% 10%, rgba(67,183,255,.12), transparent 60%),
        var(--bgImg);
      background-size: cover, cover, cover, cover;
      background-position: center, center, center, center;
      opacity:.98;
    }

    /* ===== Header ===== */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; flex-wrap:wrap; margin-bottom:12px;
    }
    .brand{ display:flex; align-items:center; gap:12px; user-select:none; }
    .logo{
      width:46px; height:46px; border-radius:16px;
      background:
        radial-gradient(circle at 30% 30%, rgba(180,92,255,.95), rgba(180,92,255,.18) 56%, transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(67,183,255,.95), rgba(67,183,255,.18) 56%, transparent 60%),
        linear-gradient(135deg, rgba(180,92,255,.12), rgba(67,183,255,.10));
      box-shadow: var(--glowBlue), var(--glowPurple);
      border:1px solid rgba(67,183,255,.28);
    }
    .title h1{
      margin:0;
      font-size:18px;
      font-weight:1000;
      letter-spacing:.2px;
      text-shadow: 0 0 18px rgba(67,183,255,.18);
    }
    .title small{
      display:block;
      margin-top:4px;
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }

    /* ===== Pills (Audio) ===== */
    .controls{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(67,183,255,.22);
      box-shadow: 0 0 0 1px rgba(180,92,255,.08) inset, var(--glowBlue);
      backdrop-filter: blur(6px);
    }
    .pill label{
      font-size:12px;
      color:var(--muted);
      font-weight:1000;
      white-space:nowrap;
    }
    input[type="range"]{
      width:160px;
      accent-color: var(--purple);
    }
    .btn{
      border:none; cursor:pointer;
      font-weight:1000;
      padding:8px 12px;
      border-radius: 999px;
      color:var(--text);
      background: rgba(0,0,0,.18);
      border:1px solid rgba(180,92,255,.40);
      box-shadow: var(--glowPurple);
      transition: transform .06s ease, filter .2s ease;
      user-select:none;
      touch-action: manipulation;
      min-height: 36px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn:hover{ filter:brightness(1.10); }
    .btn:active{ transform: translateY(1px); }

    /* Mobil i√ßin √∂zel ses butonu */
    #musicStartBtn {
      background: rgba(180,92,255,.25);
      border-color: rgba(180,92,255,.60);
      box-shadow: 0 0 12px rgba(180,92,255,.32);
    }

    /* ===== Layout ===== */
    .grid{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      input[type="range"]{ width:170px; }
      .btn { padding: 10px 14px; }
    }

    .hdrRow{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
      padding:10px 12px;
    }
    .hdrRow h2{
      margin:0;
      font-size:14px;
      font-weight:1000;
      letter-spacing:.2px;
      color:var(--text);
      text-shadow: 0 0 16px rgba(67,183,255,.14);
    }

    .badges{ display:flex; gap:8px; flex-wrap:wrap; }
    .badge{
      padding:7px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(67,183,255,.22);
      box-shadow: var(--glowBlue);
      white-space:nowrap;
    }
    .divider{
      height:1px;
      background: linear-gradient(90deg, transparent, rgba(67,183,255,.46), rgba(180,92,255,.40), transparent);
      margin:0 12px 10px;
      opacity:.90;
    }

    /* ===== Start Panel ===== */
    .startRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      padding:0 12px 12px;
    }
    @media (max-width: 680px){ .startRow{ grid-template-columns:1fr; } }

    .field label{
      display:block;
      font-size:12px;
      color:var(--muted);
      font-weight:1000;
      margin:0 0 6px;
    }
    .field input{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(67,183,255,.18);
      background: rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-weight:1000;
      letter-spacing:.2px;
      box-shadow: 0 0 0 1px rgba(180,92,255,.08) inset;
      font-size: 16px; /* iOS zoom √∂nlemi */
    }

    .modes{ display:flex; gap:10px; flex-wrap:wrap; }
    .modeBtn{
      flex:1 1 90px;
      padding:10px 10px;
      border-radius: 16px;
      border:1px solid rgba(67,183,255,.22);
      background: rgba(0,0,0,.18);
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
      text-align:center;
      box-shadow: var(--glowBlue);
      transition: transform .06s ease, filter .2s ease, border-color .2s ease, box-shadow .2s ease;
      user-select:none;
      touch-action: manipulation;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modeBtn:hover{ filter:brightness(1.08); }
    .modeBtn:active{ transform: translateY(1px); }
    .modeBtn.active{
      border-color: rgba(180,92,255,.72);
      box-shadow: 0 0 0 1px rgba(180,92,255,.22) inset, var(--glowPurple), var(--glowBlue);
    }

    .startFooter{
      display:flex;
      justify-content:flex-end;
      gap:10px;
      padding:0 12px 12px;
    }
    .startBtn{
      border:none; cursor:pointer;
      padding:12px 18px;
      border-radius: 16px;
      font-weight:1100;
      letter-spacing:.2px;
      color:var(--text);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(180,92,255,.72);
      box-shadow: 0 0 0 1px rgba(180,92,255,.20) inset, var(--glowPurple);
      transition: transform .06s ease, filter .2s ease;
      touch-action: manipulation;
      min-height: 48px;
    }
    .startBtn:hover{ filter:brightness(1.10); }
    .startBtn:active{ transform: translateY(1px); }

    /* ===== Quiz Panel ===== */
    .qbox{
      margin:0 12px 12px;
      padding:14px;
      border-radius: 18px;
      border:1px solid rgba(67,183,255,.18);
      background: rgba(0,0,0,.18);
      box-shadow: var(--glowBlue);
      min-height: 240px;
      position:relative;
      overflow:hidden;
    }

    .qbox.flashGood::before,
    .qbox.flashBad::before{
      content:"";
      position:absolute; inset:-2px;
      filter: blur(10px);
      opacity:.55;
      pointer-events:none;
    }
    .qbox.flashGood::before{ background: radial-gradient(circle at 50% 10%, rgba(34,197,94,.55), transparent 60%); }
    .qbox.flashBad::before{ background: radial-gradient(circle at 50% 10%, rgba(239,68,68,.55), transparent 60%); }

    .qTop{ display:flex; justify-content:space-between; gap:10px; margin-bottom:10px; }
    .qIdx{ font-weight:1000; color:var(--muted); font-size:12px; }
    .qText{
      margin:6px 0 0;
      font-size:19px;
      font-weight:1100;
      line-height:1.25;
      letter-spacing:.1px;
      color: var(--text);
      text-shadow: 0 0 18px rgba(67,183,255,.10);
    }
    @media (max-width: 520px){ .qText{ font-size:17.5px; } }

    .opts{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 650px){ .opts{ grid-template-columns:1fr; } }

    .opt{
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(67,183,255,.18);
      background: rgba(0,0,0,.18);
      cursor:pointer;
      font-weight:1000;
      line-height:1.2;
      transition: transform .06s ease, border-color .16s ease, box-shadow .16s ease, filter .16s ease;
      user-select:none;
      color: var(--text);
      box-shadow: 0 0 0 1px rgba(180,92,255,.06) inset;
      touch-action: manipulation;
      min-height: 60px;
      display: flex;
      align-items: center;
    }
    .opt:hover{
      filter:brightness(1.06);
      border-color: rgba(67,183,255,.46);
      box-shadow: var(--glowBlueStrong);
    }
    .opt:active{ transform: translateY(1px); }
    .opt .k{
      display:inline-block;
      min-width:26px;
      margin-right:6px;
      color: rgba(180,92,255,.96);
      text-shadow: 0 0 14px rgba(180,92,255,.18);
    }
    .opt.correct{
      border-color: rgba(34,197,94,.72);
      box-shadow: 0 0 0 1px rgba(34,197,94,.15) inset, 0 0 28px rgba(34,197,94,.16);
      background: rgba(34,197,94,.10);
    }
    .opt.wrong{
      border-color: rgba(239,68,68,.72);
      box-shadow: 0 0 0 1px rgba(239,68,68,.15) inset, 0 0 28px rgba(239,68,68,.16);
      background: rgba(239,68,68,.10);
    }
    .opt.disabled{ pointer-events:none; opacity:.93; }

    .mini{
      margin-top:10px;
      color:var(--muted);
      font-weight:900;
      font-size:12px;
    }

    .feedback{
      margin-top:10px;
      font-weight:1100;
      font-size:13px;
      letter-spacing:.2px;
      text-shadow: 0 0 14px rgba(67,183,255,.14);
      min-height:18px;
    }
    .feedback.good{ color: rgba(34,197,94,.95); text-shadow: 0 0 14px rgba(34,197,94,.18); }
    .feedback.bad{ color: rgba(239,68,68,.95); text-shadow: 0 0 14px rgba(239,68,68,.18); }

    /* ===== Finish Panel ===== */
    .finishPanel{
      margin:0 12px 12px;
      padding:14px;
      border-radius: 18px;
      border:1px solid rgba(180,92,255,.24);
      background: rgba(0,0,0,.18);
      box-shadow: var(--glowPurple);
      display:none;
    }
    .finishTitle{
      margin:0 0 8px;
      font-size:16px;
      font-weight:1100;
      letter-spacing:.2px;
      text-shadow: 0 0 18px rgba(180,92,255,.14);
    }
    .finishGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:8px;
    }
    @media (max-width: 520px){ .finishGrid{ grid-template-columns:1fr; } }
    .stat{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(67,183,255,.16);
      background: rgba(0,0,0,.14);
      box-shadow: var(--glowBlue);
      font-weight:1000;
      color:var(--text);
    }
    .stat small{ display:block; color:var(--muted); font-weight:900; margin-bottom:4px; }
    .finishBtns{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      margin-top:12px;
    }
    .btnPrimary{
      border:none; cursor:pointer;
      padding:12px 14px;
      border-radius: 14px;
      font-weight:1100;
      color:var(--text);
      background: rgba(0,0,0,.22);
      border:1px solid rgba(67,183,255,.56);
      box-shadow: var(--glowBlueStrong);
      touch-action: manipulation;
    }
    .btnGhost{
      border:none; cursor:pointer;
      padding:12px 14px;
      border-radius: 14px;
      font-weight:1100;
      color:var(--text);
      background: rgba(0,0,0,.16);
      border:1px solid rgba(180,92,255,.40);
      box-shadow: var(--glowPurple);
      touch-action: manipulation;
    }
    .btnPrimary:active,.btnGhost:active{ transform: translateY(1px); }

    /* ===== Leaderboard ===== */
    .tabs{ display:flex; gap:8px; flex-wrap:wrap; padding:0 12px 10px; }
    .tab{
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(67,183,255,.18);
      background: rgba(0,0,0,.16);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
      font-size:12px;
      user-select:none;
      box-shadow: var(--glowBlue);
      touch-action: manipulation;
    }
    .tab.active{
      border-color: rgba(67,183,255,.88);
      box-shadow: var(--glowBlueStrong);
    }

    .tableWrap{
      margin:0 12px 12px;
      overflow:auto;
      border-radius: 16px;
      border:1px solid rgba(67,183,255,.22);
      background: rgba(0,0,0,.14);
      box-shadow: var(--glowBlueStrong);
    }
    table{ width:100%; border-collapse:collapse; }
    th, td{
      padding:10px 8px;
      border-bottom:1px solid rgba(67,183,255,.10);
      text-align:left;
      font-size:12px;
      font-weight:1000;
      color:var(--text);
      vertical-align:top;
      white-space:nowrap;
    }
    th{ color:var(--muted); }
    .right{ text-align:right; }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:14px;
      background: rgba(8,7,22,.92);
      border:1px solid rgba(67,183,255,.20);
      box-shadow: 0 12px 40px rgba(0,0,0,.55);
      padding:10px 12px;
      border-radius:14px;
      font-weight:1000;
      font-size:12px;
      color:var(--text);
      opacity:0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index:9999;
      max-width:min(720px, 92vw);
      backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(-4px); }

    /* Confetti */
    #confetti{ position:fixed; inset:0; pointer-events:none; z-index:9998; }

    /* Mobil uyarƒ± mesajƒ± */
    .audioAlert {
      display: none;
      background: rgba(180,92,255,.15);
      border: 1px solid rgba(180,92,255,.3);
      border-radius: 12px;
      padding: 8px 12px;
      margin: 0 12px 12px;
      font-size: 12px;
      color: var(--muted);
      text-align: center;
    }
    
    @media (max-width: 768px) {
      .audioAlert { display: block; }
    }
  </style>
</head>

<body>
<canvas id="confetti"></canvas>

<div class="wrap">
  <div class="topbar">
    <!-- Mobil reset i√ßin: logoya 6 sn basƒ±lƒ± tut -->
    <div class="brand">
      <div class="logo" id="teacherReset"></div>
      <div class="title">
        <h1>H√ºseyin Akdaƒü ƒ∞lkokulu Fen Bilimleri 4. Tema Yarƒ±≈ümasƒ±</h1>
        <small>Pro+ ‚Ä¢ 10/20/30/40 soru ‚Ä¢ Skor ‚Ä¢ S√ºre</small>
      </div>
    </div>

    <div class="controls">
      <div class="pill">
        <label>üéµ M√ºzik</label>
        <input id="musicVol" type="range" min="0" max="1" step="0.01" value="0.35">
        <button id="musicToggle" class="btn" type="button">A√ßƒ±k</button>
        <button id="musicStartBtn" class="btn" type="button">‚ñ∂Ô∏è Ba≈ülat</button>
      </div>
      <div class="pill">
        <label>üîä Efekt</label>
        <input id="fxVol" type="range" min="0" max="1" step="0.01" value="0.60">
        <button id="fxToggle" class="btn" type="button">A√ßƒ±k</button>
      </div>
    </div>
  </div>

  <!-- Mobil ses uyarƒ±sƒ± -->
  <div class="audioAlert">
    üì± Mobil cihazlarda ses √ßalabilmesi i√ßin "‚ñ∂Ô∏è Ba≈ülat" butonuna dokunmanƒ±z gerekebilir.
  </div>

  <div class="grid">
    <!-- Oyun -->
    <div class="neonFrame">
      <div class="content">
        <div class="hdrRow">
          <h2>Oyun</h2>
          <div class="badges">
            <span id="bMode" class="badge">Mod: -</span>
            <span id="bScore" class="badge">Skor: 0</span>
            <span id="bTime" class="badge">S√ºre: 0 sn</span>
          </div>
        </div>
        <div class="divider"></div>

        <div id="startPanel">
          <div class="startRow">
            <div class="field">
              <label>√ñƒürenci Adƒ±</label>
              <input id="playerName" placeholder="" maxlength="18" />
            </div>

            <div class="field">
              <label>Soru Sayƒ±sƒ± (Mod)</label>
              <div class="modes" id="modeButtons"></div>
            </div>
          </div>

          <div class="startFooter">
            <button id="btnStart" class="startBtn" type="button">Ba≈ülat</button>
          </div>
        </div>

        <div id="quizPanel" style="display:none;">
          <div class="qbox" id="qbox">
            <div class="qTop">
              <div class="qIdx" id="qIndex">Soru -/-</div>
              <div class="qIdx" id="qHint"></div>
            </div>

            <div class="qText" id="qText">...</div>
            <div class="opts" id="opts"></div>

            <div class="mini" id="miniProgress">-</div>
            <div class="feedback" id="feedback"></div>
          </div>
        </div>

        <!-- Biti≈ü ekranƒ± -->
        <div id="finishPanel" class="finishPanel">
          <h3 class="finishTitle">Oyun Bitti üéâ</h3>
          <div class="finishGrid">
            <div class="stat"><small>√ñƒürenci</small><span id="fName">-</span></div>
            <div class="stat"><small>Mod</small><span id="fMode">-</span></div>
            <div class="stat"><small>Skor</small><span id="fScore">-</span></div>
            <div class="stat"><small>S√ºre</small><span id="fTime">-</span></div>
          </div>
          <div class="finishBtns">
            <button id="btnRestart" class="btnPrimary" type="button">Yeniden Ba≈ülat</button>
            <button id="btnHome" class="btnGhost" type="button">Ana Ekran</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Skor Tablosu -->
    <div class="neonFrame lbFrame">
      <div class="content">
        <div class="hdrRow">
          <h2>Skor Tablosu</h2>
          <div class="badges">
            <span class="badge">Firebase</span>
          </div>
        </div>
        <div class="divider"></div>

        <div class="tabs" id="lbTabs"></div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>ƒ∞sim</th>
                <th class="right">Skor</th>
                <th class="right">S√ºre</th>
              </tr>
            </thead>
            <tbody id="lbBody">
              <tr><td colspan="4" style="color:var(--muted);">Y√ºkleniyor...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="toast" class="toast"></div>

<script type="module">
  /************************************************************
   * AYARLAR
   ************************************************************/
  const ANSWER_REVEAL_MS = 1200; // doƒüru/yanlƒ±≈ü efektini g√∂rs√ºn diye

  /************************************************************
   * ARKA PLAN (3 g√∂rsel) - her oyun ba≈ülangƒ±cƒ±nda deƒüi≈üir
   ************************************************************/
  const BG_LIST = ["bg1.jpg","bg2.jpg","bg3.jpg"]; // aynƒ± klas√∂rde olmalƒ±
  let lastBg = -1;

  function pickBg(){
    if(!BG_LIST.length) return;
    let idx = Math.floor(Math.random()*BG_LIST.length);
    if(BG_LIST.length > 1 && idx === lastBg) idx = (idx+1) % BG_LIST.length;
    lastBg = idx;
    document.documentElement.style.setProperty("--bgImg", `url('${BG_LIST[idx]}')`);
  }

  // sayfa a√ßƒ±lƒ±nca bir tane se√ß
  pickBg();

  /************************************************************
   * FIREBASE CONFIG
   ************************************************************/
  const firebaseConfig = {
    apiKey: "AIzaSyDlrVdLo7ZMqhLJb-xoImcFKuLC65v_20Y",
    authDomain: "dort-islem-oyunu-608cb.firebaseapp.com",
    projectId: "dort-islem-oyunu-608cb",
    storageBucket: "dort-islem-oyunu-608cb.firebasestorage.app",
    messagingSenderId: "133255919254",
    appId: "1:133255919254:web:19b73a36e9b76d4d0a34b7",
    measurementId: "G-J0693K6LVX"
  };

  /************************************************************
   * SORU BANKASI
   ************************************************************/
  const BANK = [
    {q:"A≈üaƒüƒ±dakilerden hangisi maddeyi nitelendiren √∂zelliklerden biri deƒüildir?", a:["Suda y√ºzme","Mƒ±knatƒ±sla √ßekilme","K√ºtle","Suyu emme"], c:"C"},
    {q:"Suya atƒ±ldƒ±ƒüƒ±nda y√ºzen bir madde a≈üaƒüƒ±dakilerden hangisi olamaz?", a:["Tahta par√ßasƒ±","Plastik kapak","Ta≈ü","Pinpon topu"], c:"C"},
    {q:"A≈üaƒüƒ±daki maddelerden hangisi suyu emer?", a:["Al√ºminyum folyo","Havlu","Cam bardak","Plastik ≈üi≈üe"], c:"B"},
    {q:"Mƒ±knatƒ±s tarafƒ±ndan √ßekilen maddeler a≈üaƒüƒ±dakilerden hangisidir?", a:["Cam, plastik, altƒ±n","Demir, nikel, kobalt","Tahta, kaƒüƒ±t, pamuk","Al√ºminyum, bakƒ±r, g√ºm√º≈ü"], c:"B"},
    {q:"A≈üaƒüƒ±daki maddelerden hangisi hem suda y√ºzer hem de mƒ±knatƒ±sla √ßekilmez?", a:["Metal kapak","Plastik top","√áelik √ßivi","Al√ºminyum folyo"], c:"B"},
    {q:"Deƒüi≈ümeyen madde miktarƒ±na ne denir?", a:["Hacim","K√ºtle","Aƒüƒ±rlƒ±k","Br√ºt k√ºtle"], c:"B"},
    {q:"A≈üaƒüƒ±daki √∂l√ß√º birimlerinden hangisi k√ºtle i√ßin kullanƒ±lmaz?", a:["Kilogram","Gram","Litre","Miligram"], c:"C"},
    {q:"Sƒ±vƒ± bir maddenin net k√ºtlesini bulmak i√ßin a≈üaƒüƒ±daki form√ºlden hangisi kullanƒ±lƒ±r?", a:["Br√ºt k√ºtle + Dara","Br√ºt k√ºtle ‚Äì Dara","Net k√ºtle ‚Äì Dara","Net k√ºtle + Br√ºt k√ºtle"], c:"B"},
    {q:"Bir kabƒ±n bo≈üken k√ºtlesi 150 g, i√ßi suyla doluyken k√ºtlesi 500 g'dƒ±r. Suyun net k√ºtlesi ka√ß gramdƒ±r?", a:["350","500","650","150"], c:"A"},
    {q:"Sƒ±vƒ±larƒ±n hacmini √∂l√ßmek i√ßin a≈üaƒüƒ±dakilerden hangisi kullanƒ±lmaz?", a:["Dereceli silindir","Terazi","√ñl√ß√ºl√º kap","Beher"], c:"B"},
    {q:"1 litre ka√ß mililitredir?", a:["10","100","1000","10000"], c:"C"},
    {q:"Dereceli bir kapta 300 ml su vardƒ±r. ƒ∞√ßine bir ta≈ü atƒ±ldƒ±ƒüƒ±nda su seviyesi 450 ml'ye √ßƒ±kƒ±yor. Ta≈üƒ±n hacmi ka√ß ml'dir?", a:["150","300","450","750"], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi madde deƒüildir?", a:["Hava","I≈üƒ±k","Su","Ta≈ü"], c:"B"},
    {q:"Maddeler doƒüada ka√ß halde bulunur?", a:["2","3","4","5"], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi katƒ± maddelerin √∂zelliƒüi deƒüildir?", a:["Belirli bir ≈üekli vardƒ±r.","Akƒ±≈ükandƒ±r.","Sƒ±kƒ±≈ütƒ±rƒ±lamaz.","Dƒ±≈ü etki olmadan ≈üekli deƒüi≈ümez."], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi sƒ±vƒ± maddelerin √∂zelliƒüidir?", a:["Belirli bir ≈üekli yoktur.","Sƒ±kƒ±≈ütƒ±rƒ±labilir.","Taneleri akƒ±≈ükan deƒüildir.","Hacmi yoktur."], c:"A"},
    {q:"Gaz maddelerle ilgili a≈üaƒüƒ±dakilerden hangisi yanlƒ±≈ütƒ±r?", a:["Bulunduklarƒ± kabƒ±n ≈üeklini alƒ±rlar.","Sƒ±kƒ±≈ütƒ±rƒ±labilirler.","Belirli bir hacimleri yoktur.","Akƒ±≈ükan deƒüillerdir."], c:"D"},
    {q:"A≈üaƒüƒ±dakilerden hangisi gaz maddelere √∂rnek deƒüildir?", a:["Oksijen","Su buharƒ±","Tahta","Doƒüal gaz"], c:"C"},
    {q:"Mercimek, pirin√ß, bulgur gibi maddeler hangi haldedir?", a:["Katƒ±","Sƒ±vƒ±","Gaz","Plazma"], c:"A"},
    {q:"Isƒ± alan maddenin sƒ±caklƒ±ƒüƒ± nasƒ±l deƒüi≈üir?", a:["Artar","Azalƒ±r","Deƒüi≈ümez","√ñnce artar sonra azalƒ±r"], c:"A"},
    {q:"A≈üaƒüƒ±daki olaylardan hangisi maddenin ƒ±sƒ± vererek ger√ßekle≈ütirdiƒüi bir deƒüi≈üimdir?", a:["Erime","Buharla≈üma","Donma","Isƒ±nma"], c:"C"},
    {q:"Katƒ± haldeki bir maddenin ƒ±sƒ± alarak sƒ±vƒ± hale ge√ßmesine ne denir?", a:["Donma","Buharla≈üma","Erime","Yoƒüu≈üma"], c:"C"},
    {q:"Sƒ±vƒ± haldeki bir maddenin ƒ±sƒ± vererek katƒ± hale ge√ßmesine ne denir?", a:["Erime","Donma","Buharla≈üma","Yoƒüu≈üma"], c:"B"},
    {q:"Sƒ±vƒ± haldeki bir maddenin ƒ±sƒ± alarak gaz haline ge√ßmesine ne denir?", a:["Donma","Yoƒüu≈üma","Erime","Buharla≈üma"], c:"D"},
    {q:"A≈üaƒüƒ±dakilerden hangisi buharla≈ümaya √∂rnek deƒüildir?", a:["√áama≈üƒ±rlarƒ±n kurumasƒ±","Deniz suyunun buharla≈ümasƒ±","Kolonyanƒ±n el √ºzerinde soƒüukluk hissi vermesi","Suyun donarak buz olmasƒ±"], c:"D"},
    {q:"Buzdolabƒ±ndan √ßƒ±karƒ±lan su ≈üi≈üesinin dƒ±≈üƒ±nda su damlacƒ±klarƒ± olu≈ümasƒ± hangi olaya √∂rnektir?", a:["Erime","Donma","Buharla≈üma","Yoƒüu≈üma"], c:"D"},
    {q:"Saf maddelerle ilgili a≈üaƒüƒ±dakilerden hangisi yanlƒ±≈ütƒ±r?", a:["Tek t√ºr maddeden olu≈üurlar.","Her noktasƒ± aynƒ± √∂zelliktedir.","Karƒ±≈üƒ±mlara ayrƒ±labilirler.","≈ûeker, tuz, altƒ±n √∂rnek verilebilir."], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi saf madde deƒüildir?", a:["Su","Tuz","Limonata","Altƒ±n"], c:"C"},
    {q:"ƒ∞ki ya da daha fazla saf maddenin bir araya gelmesiyle olu≈üan maddelere ne denir?", a:["Element","Bile≈üik","Karƒ±≈üƒ±m","√á√∂zelti"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi karƒ±≈üƒ±ma √∂rnek deƒüildir?", a:["Salata","Ayran","Su","√áorba"], c:"C"},
    {q:"Karƒ±≈üƒ±mlarƒ± ayƒ±rmada kullanƒ±lan y√∂ntemlerden hangisi katƒ±-katƒ± karƒ±≈üƒ±mlarƒ± i√ßin uygundur?", a:["S√ºzme","Eleme","Buharla≈ütƒ±rma","Damƒ±tma"], c:"B"},
    {q:"Pirin√ß-su karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Y√ºzd√ºrme"], c:"B"},
    {q:"Demir tozu-kum karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin en uygun y√∂ntem hangisidir?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Buharla≈ütƒ±rma"], c:"C"},
    {q:"A≈üaƒüƒ±daki karƒ±≈üƒ±mlardan hangisi eleme y√∂ntemiyle ayrƒ±labilir?", a:["Tuz-su","Un-nohut","≈ûeker-su","Zeytinyaƒüƒ±-su"], c:"B"},
    {q:"Geri d√∂n√º≈ü√ºm kutularƒ±ndan mavi renkli olan hangi atƒ±klar i√ßindir?", a:["Plastik","Kaƒüƒ±t","Cam","Metal"], c:"B"},
    {q:"Sarƒ± geri d√∂n√º≈ü√ºm kutusu hangi atƒ±klar i√ßin kullanƒ±lƒ±r?", a:["Cam","Kaƒüƒ±t","Plastik","Organik atƒ±k"], c:"C"},
    {q:"Geri d√∂n√º≈ü√ºm√ºn faydalarƒ±ndan biri deƒüildir?", a:["Doƒüal kaynaklarƒ± korur.","Enerji tasarrufu saƒülar.","Atƒ±k miktarƒ±nƒ± artƒ±rƒ±r.","Ekonomiye katkƒ± saƒülar."], c:"C"},
    {q:"A≈üaƒüƒ±daki maddelerden hangisi suyu emmez?", a:["S√ºnger","Pamuk","Cam bardak","Havlu"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi mƒ±knatƒ±s tarafƒ±ndan √ßekilmez?", a:["√áivi","Toplu iƒüne","Al√ºminyum folyo","Demir para"], c:"C"},
    {q:"Bir maddenin bo≈ülukta kapladƒ±ƒüƒ± yere ne denir?", a:["K√ºtle","Hacim","Aƒüƒ±rlƒ±k","Yoƒüunluk"], c:"B"},
    {q:"Sƒ±vƒ±larƒ±n hacim birimi a≈üaƒüƒ±dakilerden hangisidir?", a:["Kilogram","Gram","Litre","Metre"], c:"C"},
    {q:"Katƒ± maddelerin k√ºtlesi hangi ara√ßla √∂l√ß√ºl√ºr?", a:["Dereceli silindir","Terazi","Termometre","Cetvel"], c:"B"},
    {q:"Gaz maddelerin √∂zelliklerinden biri deƒüildir?", a:["Sƒ±kƒ±≈ütƒ±rƒ±labilir.","Belirli bir ≈üekli yoktur.","Akƒ±≈ükandƒ±r.","Belirli bir hacmi vardƒ±r."], c:"D"},
    {q:"Suyun katƒ± hali a≈üaƒüƒ±dakilerden hangisidir?", a:["Su buharƒ±","Bulut","Buz","Yaƒümur"], c:"C"},
    {q:"Suyun gaz hali a≈üaƒüƒ±dakilerden hangisidir?", a:["Kar","Dolu","Su buharƒ±","√áiy"], c:"C"},
    {q:"Isƒ± veren maddenin sƒ±caklƒ±ƒüƒ± nasƒ±l deƒüi≈üir?", a:["Artar","Azalƒ±r","Deƒüi≈ümez","√ñnce artar sonra azalƒ±r"], c:"B"},
    {q:"A≈üaƒüƒ±daki maddelerden hangisi saf madde deƒüildir?", a:["Bakƒ±r tel","≈ûeker","Tuzlu su","Oksijen gazƒ±"], c:"C"},
    {q:"Karƒ±≈üƒ±mlarla ilgili a≈üaƒüƒ±dakilerden hangisi doƒürudur?", a:["Karƒ±≈üƒ±mƒ± olu≈üturan maddeler √∂zelliklerini kaybeder.","Karƒ±≈üƒ±mlar sadece katƒ± halde olur.","Karƒ±≈üƒ±mlar en az iki saf maddenin birle≈ümesiyle olu≈üur.","Karƒ±≈üƒ±mlar her zaman g√∂zle g√∂r√ºl√ºr."], c:"C"},
    {q:"Un i√ßindeki kepeƒüi ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["S√ºzme","Eleme","Mƒ±knatƒ±sla ayƒ±rma","Y√ºzd√ºrme"], c:"B"},
    {q:"Demir tozu ve tala≈ü karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem uygundur?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Buharla≈ütƒ±rma"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi suda batar?", a:["Plastik ≈üi≈üe","Tahta par√ßasƒ±","Ta≈ü","Pinpon topu"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi suda y√ºzer?", a:["√áelik ka≈üƒ±k","Metal para","Tahta","Anahtar"], c:"C"},
    {q:"Su ge√ßirmeyen kƒ±yafetler hangi √∂zellikteki maddelerden yapƒ±lƒ±r?", a:["Suyu emen","Suyu emmeyen","Suda batan","Mƒ±knatƒ±sla √ßekilen"], c:"B"},
    {q:"Hurdalƒ±klarda metalleri ayƒ±rmak i√ßin hangi √∂zellikten yararlanƒ±lƒ±r?", a:["Suda y√ºzme","Suyu emme","Mƒ±knatƒ±sla √ßekilme","Hacim"], c:"C"},
    {q:"K√ºtle √∂l√ß√ºm√ºnde kullanƒ±lan birim a≈üaƒüƒ±dakilerden hangisidir?", a:["Litre","Metre","Kilogram","Santimetre"], c:"C"},
    {q:"1 kilogram ka√ß gramdƒ±r?", a:["10","100","1000","10000"], c:"C"},
    {q:"Sƒ±vƒ±larƒ±n k√ºtlesini √∂l√ßerken a≈üaƒüƒ±dakilerden hangisi yapƒ±lƒ±r?", a:["Sƒ±vƒ± direkt teraziye konur.","Bo≈ü kabƒ±n k√ºtlesi √∂l√ß√ºl√ºr.","Sƒ±vƒ±nƒ±n hacmi √∂l√ß√ºl√ºr.","Sƒ±vƒ±nƒ±n rengine bakƒ±lƒ±r."], c:"B"},
    {q:"Br√ºt k√ºtle ne demektir?", a:["Sƒ±vƒ±nƒ±n net k√ºtlesi","Kabƒ±n k√ºtlesi","Sƒ±vƒ± ve kabƒ±n toplam k√ºtlesi","Sƒ±vƒ±nƒ±n hacmi"], c:"C"},
    {q:"Dara neyi ifade eder?", a:["Sƒ±vƒ±nƒ±n k√ºtlesi","Kabƒ±n k√ºtlesi","Toplam k√ºtle","Sƒ±vƒ±nƒ±n hacmi"], c:"B"},
    {q:"Hacim √∂l√ßmek i√ßin kullanƒ±lan ara√ßlardan biri deƒüildir?", a:["Dereceli silindir","Terazi","√ñl√ß√ºl√º kap","Beher"], c:"B"},
    {q:"Katƒ± bir cismin hacmi nasƒ±l √∂l√ß√ºl√ºr?", a:["Dereceli kaptaki suyun y√ºkselme miktarƒ±ndan","Terazide tartarak","Cetvelle √∂l√ßerek","G√∂zle tahmin ederek"], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi madde deƒüildir?", a:["Hava","Su","I≈üƒ±k","Toprak"], c:"C"},
    {q:"Maddelerin ortak √∂zellikleri a≈üaƒüƒ±dakilerden hangisidir?", a:["K√ºtle ve hacim","Renk ve koku","Suda y√ºzme","Mƒ±knatƒ±sla √ßekilme"], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi katƒ± maddelerin √∂zelliƒüidir?", a:["Konulduƒüu kabƒ±n ≈üeklini alƒ±r.","Belirli bir ≈üekli yoktur.","Belirli bir ≈üekli vardƒ±r.","Sƒ±kƒ±≈ütƒ±rƒ±labilir."], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi sƒ±vƒ± maddelerin √∂zelliƒüi deƒüildir?", a:["Akƒ±≈ükandƒ±r.","Belirli bir hacmi vardƒ±r.","Belirli bir ≈üekli yoktur.","Sƒ±kƒ±≈ütƒ±rƒ±labilir."], c:"D"},
    {q:"Gaz maddelerle ilgili doƒüru ifade hangisidir?", a:["Belirli bir hacimleri yoktur.","Belirli bir ≈üekilleri vardƒ±r.","Sƒ±kƒ±≈ütƒ±rƒ±lamazlar.","Akƒ±≈ükan deƒüillerdir."], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi katƒ± maddelere √∂rnektir?", a:["Su","Hava","Ta≈ü","Su buharƒ±"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi sƒ±vƒ± maddelere √∂rnektir?", a:["Buz","Zeytinyaƒüƒ±","Oksijen","Demir"], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi gaz maddelere √∂rnektir?", a:["Tahta","Su","Karbondioksit","Tuz"], c:"C"},
    {q:"Isƒ± alƒ±≈üveri≈üi hangi y√∂nde ger√ßekle≈üir?", a:["Soƒüuk maddeden sƒ±cak maddeye","Sƒ±cak maddeden soƒüuk maddeye","Her iki y√∂nde de","Isƒ± alƒ±≈üveri≈üi olmaz"], c:"B"},
    {q:"Sƒ±caklƒ±ƒüƒ± √∂l√ßen aletin adƒ± nedir?", a:["Barometre","Termometre","Higrometre","Anemometre"], c:"B"},
    {q:"Sƒ±caklƒ±k birimi nedir?", a:["Kilogram","Litre","Derece Celsius","Gram"], c:"C"},
    {q:"Donma olayƒ±nda madde ne yapar?", a:["Isƒ± alƒ±r","Isƒ± verir","Sƒ±caklƒ±ƒüƒ± artar","Hacmi artar"], c:"B"},
    {q:"Buharla≈üma olayƒ±nda madde ne yapar?", a:["Isƒ± alƒ±r","Isƒ± verir","Sƒ±caklƒ±ƒüƒ± d√º≈üer","Hacmi azalƒ±r"], c:"A"},
    {q:"Erime olayƒ±nda madde ne yapar?", a:["Isƒ± alƒ±r","Isƒ± verir","Sƒ±caklƒ±ƒüƒ± d√º≈üer","Hacmi artar"], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi erimeye √∂rnektir?", a:["Suyun buz olmasƒ±","Dondurmanƒ±n erimesi","Suyun kaynamasƒ±","√áama≈üƒ±rlarƒ±n kurumasƒ±"], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi donmaya √∂rnektir?", a:["Suyun buharla≈ümasƒ±","Buzun erimesi","G√∂l√ºn buz tutmasƒ±","Kolonyanƒ±n u√ßmasƒ±"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi buharla≈ümaya √∂rnektir?", a:["Suyun kaynamasƒ±","Suyun donmasƒ±","Buzun erimesi","Yaƒümurun yaƒümasƒ±"], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi yoƒüu≈ümaya √∂rnektir?", a:["Suyun buharla≈ümasƒ±","Buzdolabƒ±ndan √ßƒ±kan su ≈üi≈üesinde damlalarƒ±n olu≈ümasƒ±","Suyun kaynamasƒ±","Dondurmanƒ±n erimesi"], c:"B"},
    {q:"Saf maddelerle ilgili a≈üaƒüƒ±dakilerden hangisi yanlƒ±≈ütƒ±r?", a:["Tek t√ºr maddeden olu≈üur.","Her noktasƒ± aynƒ± √∂zelliktedir.","Karƒ±≈üƒ±mlara ayrƒ±≈ütƒ±rƒ±labilir.","√ñrnek: altƒ±n, bakƒ±r, ≈üeker"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi saf maddedir?", a:["Ayran","≈ûeker","Limonata","√áorba"], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi karƒ±≈üƒ±mdƒ±r?", a:["Su","Tuz","Hava","Altƒ±n"], c:"C"},
    {q:"Karƒ±≈üƒ±mlarƒ± ayƒ±rma y√∂ntemlerinden hangisi katƒ±-sƒ±vƒ± karƒ±≈üƒ±mlarƒ± i√ßin kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Y√ºzd√ºrme"], c:"B"},
    {q:"Demir tozu ve kum karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Buharla≈ütƒ±rma"], c:"C"},
    {q:"Un ve pirin√ß karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Y√ºzd√ºrme"], c:"A"},
    {q:"√áay yapraklarƒ±nƒ± √ßaydan ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Mƒ±knatƒ±sla ayƒ±rma","Buharla≈ütƒ±rma"], c:"B"},
    {q:"Geri d√∂n√º≈ü√ºm√ºn faydalarƒ±ndan biri deƒüildir?", a:["Doƒüal kaynaklarƒ± t√ºketir.","Enerji tasarrufu saƒülar.","√áevre kirliliƒüini azaltƒ±r.","Ekonomiye katkƒ± saƒülar."], c:"A"},
    {q:"Cam atƒ±klar hangi renk geri d√∂n√º≈ü√ºm kutusuna atƒ±lƒ±r?", a:["Mavi","Sarƒ±","Ye≈üil","Gri"], c:"C"},
    {q:"Plastik atƒ±klar hangi renk geri d√∂n√º≈ü√ºm kutusuna atƒ±lƒ±r?", a:["Mavi","Sarƒ±","Ye≈üil","Gri"], c:"B"},
    {q:"Kaƒüƒ±t atƒ±klar hangi renk geri d√∂n√º≈ü√ºm kutusuna atƒ±lƒ±r?", a:["Mavi","Sarƒ±","Ye≈üil","Gri"], c:"A"},
    {q:"Metal atƒ±klar hangi renk geri d√∂n√º≈ü√ºm kutusuna atƒ±lƒ±r?", a:["Mavi","Sarƒ±","Ye≈üil","Gri"], c:"D"},
    {q:"A≈üaƒüƒ±dakilerden hangisi suyu emen maddelerdendir?", a:["Plastik tabak","Cam bardak","Havlu","Metal ka≈üƒ±k"], c:"C"},
    {q:"A≈üaƒüƒ±dakilerden hangisi mƒ±knatƒ±s tarafƒ±ndan √ßekilir?", a:["Cam","Tahta","Demir","Plastik"], c:"C"},
    {q:"K√ºtle √∂l√ß√ºm√ºnde kullanƒ±lan ara√ßlardan biri deƒüildir?", a:["Terazi","Bask√ºl","Dereceli silindir","E≈üit kollu terazi"], c:"C"},
    {q:"Hacim √∂l√ß√ºm√ºnde kullanƒ±lan ara√ßlardan biri deƒüildir?", a:["Terazi","Dereceli silindir","√ñl√ß√ºl√º kap","Beher"], c:"A"},
    {q:"2 litre ka√ß mililitredir?", a:["20","200","2000","20000"], c:"C"},
    {q:"500 gram ka√ß kilogramdƒ±r?", a:["0,5","5","50","5000"], c:"A"},
    {q:"Br√ºt k√ºtlesi 800 g, darasƒ± 200 g olan sƒ±vƒ±nƒ±n net k√ºtlesi ka√ß gramdƒ±r?", a:["600","800","1000","200"], c:"A"},
    {q:"Bir maddenin k√ºtlesi ve hacmi varsa o madde i√ßin ne s√∂ylenebilir?", a:["Madde deƒüildir.","Maddedir.","Sadece katƒ±dƒ±r.","Sadece sƒ±vƒ±dƒ±r."], c:"B"},
    {q:"A≈üaƒüƒ±dakilerden hangisi madde deƒüildir?", a:["Ses","Ta≈ü","Su","Hava"], c:"A"},
    {q:"Maddeleri duyu organlarƒ±mƒ±zla ayƒ±rt edebileceƒüimiz √∂zelliklerden biri deƒüildir?", a:["Renk","Koku","Tat","K√ºtle"], c:"D"},
    {q:"Tahta, plastik, cam gibi maddeler suda genellikle ne yapar?", a:["Batar","Y√ºzer","√á√∂z√ºn√ºr","Sƒ±kƒ±≈üƒ±r"], c:"B"},
    {q:"Demir, nikel, kobalt gibi maddeler hangi √∂zellik g√∂sterir?", a:["Suyu emer","Mƒ±knatƒ±sla √ßekilir","Suda y√ºzer","Suda batar"], c:"B"},
    {q:"A≈üaƒüƒ±daki maddelerden hangisi suda batmaz?", a:["Ta≈ü","Metal para","Plastik ≈üi≈üe","√áelik √ßivi"], c:"C"},
    {q:"Suyu emen maddeler hangi ama√ßla kullanƒ±lƒ±r?", a:["Su ge√ßirmez kƒ±yafetlerde","Kurulamada","Yalƒ±tƒ±mda","S√ºs e≈üyalarƒ±nda"], c:"B"},
    {q:"Suyu emmeyen maddeler hangi ama√ßla kullanƒ±lƒ±r?", a:["Havlu yapƒ±mƒ±nda","Pe√ßete yapƒ±mƒ±nda","Yaƒümurluk yapƒ±mƒ±nda","S√ºnger yapƒ±mƒ±nda"], c:"C"},
    {q:"Gemilerin suda y√ºzmesini saƒülayan ≈üey nedir?", a:["Aƒüƒ±r olmalarƒ±","Suyu emmeleri","Hacimlerinin b√ºy√ºk olmasƒ±","≈ûekilleri"], c:"C"},
    {q:"√áivinin suda batmasƒ±nƒ±n nedeni nedir?", a:["Suyu emmesi","Mƒ±knatƒ±sla √ßekilmesi","Yoƒüunluƒüunun sudan fazla olmasƒ±","Hacminin k√º√ß√ºk olmasƒ±"], c:"C"},
    {q:"K√ºtle ile ilgili a≈üaƒüƒ±dakilerden hangisi doƒürudur?", a:["Deƒüi≈ümeyen madde miktarƒ±dƒ±r.","Bo≈ülukta kapladƒ±ƒüƒ± yerdir.","Duyu organlarƒ±yla algƒ±lanƒ±r.","Sadece katƒ±larda vardƒ±r."], c:"A"},
    {q:"Hacim ile ilgili a≈üaƒüƒ±dakilerden hangisi doƒürudur?", a:["Deƒüi≈ümeyen madde miktarƒ±dƒ±r.","Bo≈ülukta kapladƒ±ƒüƒ± yerdir.","Terazi ile √∂l√ß√ºl√ºr.","Sadece sƒ±vƒ±larda vardƒ±r."], c:"B"},
    {q:"Bir cismin k√ºtlesi D√ºnya'da ve Ay'da √∂l√ß√ºld√ºƒü√ºnde nasƒ±l deƒüi≈üir?", a:["D√ºnya'da daha fazladƒ±r.","Ay'da daha fazladƒ±r.","Aynƒ±dƒ±r.","√ñl√ß√ºlemez."], c:"C"},
    {q:"Bir cismin aƒüƒ±rlƒ±ƒüƒ± D√ºnya'da ve Ay'da √∂l√ß√ºld√ºƒü√ºnde nasƒ±l deƒüi≈üir?", a:["D√ºnya'da daha fazladƒ±r.","Ay'da daha fazladƒ±r.","Aynƒ±dƒ±r.","√ñl√ß√ºlemez."], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi sƒ±vƒ±larƒ±n √∂zelliƒüi deƒüildir?", a:["Akƒ±≈ükandƒ±r.","Belirli bir ≈üekli yoktur.","Sƒ±kƒ±≈ütƒ±rƒ±lamaz.","Tanecikleri arasƒ±ndaki bo≈üluk fazladƒ±r."], c:"D"},
    {q:"Gazlarƒ±n √∂zelliklerinden biri deƒüildir?", a:["Bulunduklarƒ± kabƒ±n ≈üeklini alƒ±rlar.","Sƒ±kƒ±≈ütƒ±rƒ±labilirler.","Belirli bir hacimleri yoktur.","Akƒ±≈ükan deƒüillerdir."], c:"D"},
    {q:"A≈üaƒüƒ±dakilerden hangisi katƒ±, sƒ±vƒ± ve gaz hallerinde bulunabilir?", a:["Demir","Su","Tahta","Cam"], c:"B"},
    {q:"Isƒ± alan buz ne olur?", a:["Su","Su buharƒ±","Kar","Yaƒümur"], c:"A"},
    {q:"Isƒ± veren su ne olur?", a:["Buz","Su buharƒ±","Kar","√áiy"], c:"A"},
    {q:"Sƒ±cak √ßayƒ±n soƒüumasƒ± hangi olaya √∂rnektir?", a:["Isƒ±nma","Soƒüuma","Erime","Donma"], c:"B"},
    {q:"Soƒüuk s√ºt√ºn ƒ±sƒ±nmasƒ± hangi olaya √∂rnektir?", a:["Isƒ±nma","Soƒüuma","Erime","Donma"], c:"A"},
    {q:"Saf maddelerle karƒ±≈üƒ±mlar arasƒ±ndaki fark nedir?", a:["Saf maddeler tek t√ºr, karƒ±≈üƒ±mlar birden fazla t√ºr madde i√ßerir.","Saf maddeler karƒ±≈üƒ±mlara g√∂re daha hafiftir.","Karƒ±≈üƒ±mlar saf maddelere g√∂re daha k√º√ß√ºkt√ºr.","Saf maddeler sadece katƒ± halde bulunur."], c:"A"},
    {q:"A≈üaƒüƒ±dakilerden hangisi karƒ±≈üƒ±m deƒüildir?", a:["Meyve suyu","≈ûeker","Salata","√áorba"], c:"B"},
    {q:"Karƒ±≈üƒ±mlar nasƒ±l ayrƒ±≈ütƒ±rƒ±labilir?", a:["Karƒ±≈üƒ±mƒ± olu≈üturan maddelerin √∂zelliklerine g√∂re","Sadece ƒ±sƒ± vererek","Sadece suya atarak","Sadece mƒ±knatƒ±s kullanarak"], c:"A"},
    {q:"Tuzlu su karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Buharla≈ütƒ±rma","Mƒ±knatƒ±sla ayƒ±rma"], c:"C"},
    {q:"Kum ve √ßakƒ±l karƒ±≈üƒ±mƒ±nƒ± ayƒ±rmak i√ßin hangi y√∂ntem kullanƒ±lƒ±r?", a:["Eleme","S√ºzme","Buharla≈ütƒ±rma","Mƒ±knatƒ±sla ayƒ±rma"], c:"A"}
  ];

  /************************************************************
   * Yardƒ±mcƒ±lar + Toast
   ************************************************************/
  const $ = (id)=>document.getElementById(id);
  const toastEl = $("toast");
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add("show");
    clearTimeout(toastEl._t);
    toastEl._t = setTimeout(()=>toastEl.classList.remove("show"), 2200);
  }

  /************************************************************
   * SES Sƒ∞STEMƒ∞ - MOBƒ∞L UYUMLU
   ************************************************************/
  const music = new Audio("madde.mp3");
  music.loop = true; 
  music.preload = "auto";
  music.load();
  
  const sOK = new Audio("alkƒ±s.mp3");
  const sNO = new Audio("hata.mp3");
  
  [sOK, sNO].forEach(a => {
    a.preload = "auto";
    a.load();
  });

  let musicOn = true, fxOn = true;
  let musicVol = 0.35, fxVol = 0.60;
  let musicStarted = false;
  let audioContextInitialized = false;

  function applyAudio(){
    music.volume = musicOn ? musicVol : 0;
    sOK.volume = fxOn ? fxVol : 0;
    sNO.volume = fxOn ? fxVol : 0;
  }
  applyAudio();

  // Ses kontrolleri
  $("musicVol").addEventListener("input",(e)=>{ 
    musicVol = +e.target.value; 
    applyAudio(); 
  });
  $("fxVol").addEventListener("input",(e)=>{ 
    fxVol = +e.target.value; 
    applyAudio(); 
  });

  $("musicToggle").addEventListener("click",()=>{
    musicOn = !musicOn;
    $("musicToggle").textContent = musicOn ? "A√ßƒ±k" : "Kapalƒ±";
    applyAudio();
  });
  $("fxToggle").addEventListener("click",()=>{
    fxOn = !fxOn;
    $("fxToggle").textContent = fxOn ? "A√ßƒ±k" : "Kapalƒ±";
    applyAudio();
  });

  // Mobil i√ßin √∂zel ses ba≈ülatma butonu
  $("musicStartBtn").addEventListener("click", async () => {
    await startMusic();
  });

  async function startMusic() {
    if (musicStarted) return;
    
    try {
      // iOS i√ßin gerekli: user gesture sonrasƒ± play
      await music.play();
      musicStarted = true;
      $("musicStartBtn").textContent = "‚úÖ Ba≈ülatƒ±ldƒ±";
      $("musicStartBtn").style.opacity = "0.7";
      toast("M√ºzik ba≈ülatƒ±ldƒ±");
      
      // Otomatik olarak m√ºzik a√ßƒ±k moduna ge√ß
      musicOn = true;
      $("musicToggle").textContent = "A√ßƒ±k";
      applyAudio();
      
      return true;
    } catch (err) {
      console.log("M√ºzik ba≈ülatma hatasƒ±:", err);
      toast("M√ºzik ba≈ülatƒ±lamadƒ±. Ses a√ßƒ±k mƒ±?");
      return false;
    }
  }

  async function playFx(audio){
    if(!fxOn) return;
    
    // Mobilde ses ba≈ülatƒ±lmadƒ±ysa √∂nce ba≈ülat
    if (!musicStarted) {
      const started = await startMusic();
      if (!started) return;
    }
    
    try{
      audio.currentTime = 0;
      await audio.play();
    }catch(err){
      console.log("Efekt sesi hatasƒ±:", err);
    }
  }

  // Oyun ba≈ülatƒ±ldƒ±ƒüƒ±nda m√ºziƒüi de ba≈ülat
  $("btnStart").addEventListener("click", async () => {
    await startMusic();
    startGame();
  });

  // Sayfa y√ºklendiƒüinde touch/click event'leri dinle
  function initAudioOnUserInteraction() {
    const initAudio = async () => {
      if (!musicStarted) {
        await startMusic();
      }
    };
    
    ["click", "touchstart", "keydown"].forEach(ev => {
      window.addEventListener(ev, initAudio, { once: true, passive: true });
    });
  }
  
  // Sayfa y√ºklendiƒüinde ses ba≈ülatma hazƒ±rlƒ±ƒüƒ±
  window.addEventListener("DOMContentLoaded", initAudioOnUserInteraction);

  /************************************************************
   * Confetti (mor + mavi)
   ************************************************************/
  const confettiCanvas = $("confetti");
  const ctx = confettiCanvas.getContext("2d");
  function resizeConfetti(){
    confettiCanvas.width = innerWidth * devicePixelRatio;
    confettiCanvas.height = innerHeight * devicePixelRatio;
  }
  addEventListener("resize", resizeConfetti);
  resizeConfetti();

  let confetti = [];
  function burstConfetti(){
    const W=confettiCanvas.width, H=confettiCanvas.height;
    for(let i=0;i<200;i++){
      confetti.push({
        x: W*0.5 + (Math.random()-0.5)*W*0.14,
        y: H*0.18 + (Math.random()-0.5)*H*0.08,
        vx: (Math.random()-0.5)*8*devicePixelRatio,
        vy: (Math.random()*-10 - 6)*devicePixelRatio,
        g: (0.35 + Math.random()*0.25)*devicePixelRatio,
        w: (2.0 + Math.random()*4.2)*devicePixelRatio,
        h: (1.0 + Math.random()*2.5)*devicePixelRatio,
        a: 1,
        rot: Math.random()*Math.PI,
        vr: (Math.random()-0.5)*0.25,
        t: Math.random() < 0.5 ? "P" : "B"
      });
    }
  }
  function tickConfetti(){
    const W=confettiCanvas.width, H=confettiCanvas.height;
    ctx.clearRect(0,0,W,H);
    confetti = confetti.filter(p=>p.a>0.02 && p.y < H + 80*devicePixelRatio);
    for(const p of confetti){
      p.vy += p.g;
      p.x += p.vx;
      p.y += p.vy;
      p.rot += p.vr;
      p.a *= 0.985;

      ctx.save();
      ctx.globalAlpha = p.a;
      ctx.translate(p.x,p.y);
      ctx.rotate(p.rot);
      ctx.fillStyle = (p.t==="P") ? "rgba(180,92,255,1)" : "rgba(67,183,255,1)";
      ctx.fillRect(-p.w, -p.h, p.w*2, p.h*2);
      ctx.restore();
    }
    requestAnimationFrame(tickConfetti);
  }
  tickConfetti();

  /************************************************************
   * Oyun Mantƒ±ƒüƒ±
   ************************************************************/
  const MODE_LIST = [10,20,30,40];

  const S = {
    mode: 10,
    lbMode: 10,
    player: "",
    score: 0,
    idx: 0,
    selected: [],
    startedAt: 0,
    timeSec: 0,
    timer: null,
    locked: false,
    resetVersion: 1
  };

  // Oturum boyunca tekrar etmeyen havuzlar (mode bazlƒ±)
  const SESSION_POOLS = new Map(); // mode -> { pool:[idx...], ptr:number }

  function makePool(){
    const arr = BANK.map((_,i)=>i);
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function pickQuestionsNoRepeatSession(mode){
    if(mode > BANK.length) return [];
    let entry = SESSION_POOLS.get(mode);
    if(!entry || !Array.isArray(entry.pool) || typeof entry.ptr!=="number"){
      entry = { pool: makePool(), ptr: 0 };
      SESSION_POOLS.set(mode, entry);
    }

    // Havuzda yeterli kalmadƒ±ysa yeniden karƒ±≈ütƒ±r
    if(entry.ptr + mode > entry.pool.length){
      entry.pool = makePool();
      entry.ptr = 0;
    }

    const slice = entry.pool.slice(entry.ptr, entry.ptr + mode);
    entry.ptr += mode;
    return slice;
  }

  const BANNED = [
    "amk","aq","siktir","sik","yarrak","orospu","pi√ß","pƒ±c","p1√ß","ananƒ±","anan","babanƒ±","baba","mk",
    "salak","mal","gerizekalƒ±","aptal","yav≈üak","ibne"
  ];
  function normalizeName(str){
    return (str||"").trim().replace(/\s+/g," ").replace(/[^\p{L}\p{N}\s.'-]/gu,"");
  }
  function isBadName(name){
    const n = name.toLowerCase().replace(/\s+/g,"");
    if(n.length < 2) return true;
    return BANNED.some(w => n.includes(w));
  }

  const bMode = $("bMode");
  const bScore = $("bScore");
  const bTime = $("bTime");

  const startPanel = $("startPanel");
  const quizPanel = $("quizPanel");
  const finishPanel = $("finishPanel");

  const qIndex = $("qIndex");
  const qText = $("qText");
  const opts = $("opts");
  const miniProgress = $("miniProgress");
  const feedback = $("feedback");
  const qbox = $("qbox");

  function setBadges(){
    bMode.textContent = `Mod: ${S.mode}`;
    bScore.textContent = `Skor: ${S.score}`;
    bTime.textContent = `S√ºre: ${S.timeSec} sn`;
  }

  function resetUIToStart(){
    clearInterval(S.timer);
    S.timer=null;
    S.locked=false;
    feedback.textContent = "";
    feedback.className = "feedback";
    qbox.classList.remove("flashGood","flashBad");

    quizPanel.style.display="none";
    finishPanel.style.display="none";
    startPanel.style.display="block";
    setBadges();
  }

  // Mod butonlarƒ±
  const modeButtons = $("modeButtons");
  function renderModeButtons(){
    modeButtons.innerHTML="";
    for(const m of MODE_LIST){
      const d=document.createElement("div");
      d.className="modeBtn"+(m===S.mode?" active":"");
      d.textContent = `${m} Soru`;
      d.addEventListener("click",()=>{
        S.mode=m;
        [...modeButtons.children].forEach(x=>x.classList.remove("active"));
        d.classList.add("active");
        setBadges();
      });
      modeButtons.appendChild(d);
    }
  }
  renderModeButtons();

  // Skor tablosu sekmeleri
  const lbTabs = $("lbTabs");
  function renderLBTabs(){
    lbTabs.innerHTML="";
    for(const m of MODE_LIST){
      const t=document.createElement("div");
      t.className="tab"+(m===S.lbMode?" active":"");
      t.textContent = `${m} Soru`;
      t.addEventListener("click",()=>{
        S.lbMode=m;
        renderLBTabs();
        renderLeaderboard();
      });
      lbTabs.appendChild(t);
    }
  }
  renderLBTabs();

  function showQuestion(){
    qbox.classList.remove("flashGood","flashBad");
    feedback.textContent = "";
    feedback.className = "feedback";

    const cur = BANK[S.selected[S.idx]];
    qIndex.textContent = `Soru ${S.idx+1}/${S.mode}`;
    qText.textContent = cur.q;

    opts.innerHTML="";
    const letters=["A","B","C","D"];
    for(let i=0;i<4;i++){
      const el=document.createElement("div");
      el.className="opt";
      el.innerHTML = `<span class="k">${letters[i]})</span>${cur.a[i]}`;
      el.addEventListener("click",()=>choose(letters[i]));
      
      // Mobil touch i√ßin
      el.addEventListener("touchstart", function(e) {
        e.preventDefault();
        this.style.transform = "scale(0.98)";
      }, { passive: false });
      
      el.addEventListener("touchend", function() {
        this.style.transform = "";
      });
      
      opts.appendChild(el);
    }
    miniProgress.textContent = `Doƒüru: ${S.score} ‚Ä¢ Kalan: ${S.mode-(S.idx+1)}`;
    setBadges();
  }

  async function choose(letter){
    if(S.locked) return;
    S.locked=true;

    const cur = BANK[S.selected[S.idx]];
    const correct = cur.c;

    [...opts.children].forEach(x=>x.classList.add("disabled"));

    const letters=["A","B","C","D"];
    for(let i=0;i<4;i++){
      const el=opts.children[i];
      if(letters[i]===correct) el.classList.add("correct");
      if(letters[i]===letter && letter!==correct) el.classList.add("wrong");
    }

    const isCorrect = (letter===correct);

    if(isCorrect){
      S.score++;
      qbox.classList.add("flashGood");
      feedback.textContent = "Doƒüru ‚úÖ";
      feedback.classList.add("good");
      burstConfetti();
      await playFx(sOK);
      if(navigator.vibrate) try{ navigator.vibrate(30); }catch{}
    }else{
      qbox.classList.add("flashBad");
      feedback.textContent = "Yanlƒ±≈ü ‚ùå";
      feedback.classList.add("bad");
      await playFx(sNO);
      if(navigator.vibrate) try{ navigator.vibrate([20,40,20]); }catch{}
    }

    setBadges();

    setTimeout(async ()=>{
      S.idx++;
      S.locked=false;

      if(S.idx >= S.mode){
        await finishGameAndSave();
      }else{
        showQuestion();
      }
    }, ANSWER_REVEAL_MS);
  }

  function startGame(){
    if(S.mode > BANK.length){
      toast("Soru bankasƒ± yetersiz.");
      return;
    }

    const raw = $("playerName").value;
    const name = normalizeName(raw);

    if(!name || name.length>18 || isBadName(name)){
      toast("ƒ∞sim uygun deƒüil.");
      return;
    }

    // Her oyun ba≈ülangƒ±cƒ±nda arka plan deƒüi≈üsin
    pickBg();

    finishPanel.style.display="none";
    startPanel.style.display="none";
    quizPanel.style.display="block";

    S.player=name;
    S.score=0;
    S.idx=0;

    // ‚úÖ Oturum boyunca tekrar etmeyen rastgele se√ßim
    S.selected = pickQuestionsNoRepeatSession(S.mode);

    S.startedAt=Date.now();
    S.timeSec=0;
    S.locked=false;

    clearInterval(S.timer);
    S.timer = setInterval(()=>{
      S.timeSec = Math.floor((Date.now()-S.startedAt)/1000);
      bTime.textContent = `S√ºre: ${S.timeSec} sn`;
    }, 250);

    setBadges();
    showQuestion();
  }

  async function finishGameAndSave(){
    clearInterval(S.timer);
    S.timer=null;
    setBadges();

    $("fName").textContent = S.player;
    $("fMode").textContent = `${S.mode} Soru`;
    $("fScore").textContent = `${S.score}/${S.mode}`;
    $("fTime").textContent = fmtTime(S.timeSec);

    quizPanel.style.display="none";
    finishPanel.style.display="block";

    await saveScoreToFirebase();
    renderLeaderboard();
  }

  $("btnStart").addEventListener("click", startGame);

  $("btnRestart").addEventListener("click", ()=>{
    // aynƒ± isimle tekrar ba≈ülat
    finishPanel.style.display="none";
    startPanel.style.display="none";
    quizPanel.style.display="block";

    // Her restart'ta da arka plan deƒüi≈üsin
    pickBg();

    S.score=0;
    S.idx=0;
    S.selected = pickQuestionsNoRepeatSession(S.mode);
    S.startedAt=Date.now();
    S.timeSec=0;
    S.locked=false;

    clearInterval(S.timer);
    S.timer = setInterval(()=>{
      S.timeSec = Math.floor((Date.now()-S.startedAt)/1000);
      bTime.textContent = `S√ºre: ${S.timeSec} sn`;
    }, 250);

    setBadges();
    showQuestion();
  });

  $("btnHome").addEventListener("click", ()=>{
    resetUIToStart();
  });

  /************************************************************
   * FIREBASE (Firestore)
   ************************************************************/
  let app=null, db=null, cloudReady=false;
  let fs=null;

  const SETTINGS_DOC = ["settings","global"]; // resetVersion burada

  async function initFirebase(){
    try{
      const { initializeApp } = await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js");
      const {
        getFirestore, collection, addDoc, query, where, orderBy, limit, getDocs,
        serverTimestamp, doc, getDoc, setDoc, updateDoc, onSnapshot
      } = await import("https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js");

      fs = { getFirestore, collection, addDoc, query, where, orderBy, limit, getDocs, serverTimestamp, doc, getDoc, setDoc, updateDoc, onSnapshot };

      app = initializeApp(firebaseConfig);
      db = getFirestore(app);
      cloudReady = true;

      await ensureSettingsDoc();
      await syncResetVersion();
      await renderLeaderboard();

      // PC: Shift + Z reset
      addEventListener("keydown", async (e)=>{
        if(e.shiftKey && e.key.toLowerCase()==="z"){
          const ok = confirm("Skor tablosu sƒ±fƒ±rlansƒ±n mƒ±?");
          if(!ok) return;
          try{
            await cloudResetAll();
            toast("Sƒ±fƒ±rlandƒ± ‚úÖ");
          }catch(err){
            console.warn(err);
            toast("Sƒ±fƒ±rlama: " + (err?.code || "hata"));
          }
        }
      });

      // Mobil: logoya 6sn basƒ±lƒ± tut
      enableMobileResetGesture();

    }catch(err){
      console.warn(err);
      $("lbBody").innerHTML = `<tr><td colspan="4" style="color:var(--muted);">Firebase baƒülantƒ±sƒ± yok.</td></tr>`;
      toast("Firebase: baƒülantƒ± yok");
    }
  }

  async function ensureSettingsDoc(){
    if(!cloudReady || !db) return;
    const { doc, getDoc, setDoc, serverTimestamp } = fs;
    const ref = doc(db, ...SETTINGS_DOC);
    try{
      const snap = await getDoc(ref);
      if(!snap.exists()){
        await setDoc(ref, { resetVersion: 1, createdAt: serverTimestamp() }, { merge:true });
      }
    }catch(err){
      console.warn(err);
      toast("settings/global: " + (err?.code || "hata"));
    }
  }

  async function syncResetVersion(){
    if(!cloudReady || !db) return;
    const { doc, getDoc, onSnapshot } = fs;
    const ref = doc(db, ...SETTINGS_DOC);

    try{
      const snap = await getDoc(ref);
      if(snap.exists()){
        const v = snap.data().resetVersion;
        if(typeof v === "number") S.resetVersion = v;
      }
    }catch{}

    try{
      onSnapshot(ref, (snap)=>{
        if(!snap.exists()) return;
        const v = snap.data().resetVersion;
        if(typeof v !== "number") return;
        if(v !== S.resetVersion){
          S.resetVersion = v;
          renderLeaderboard();
        }
      });
    }catch{}
  }

  async function cloudResetAll(){
    const { doc, setDoc, serverTimestamp } = fs;
    const ref = doc(db, ...SETTINGS_DOC);
    const next = (S.resetVersion || 1) + 1;
    // ‚úÖ doc yoksa bile √ßalƒ±≈üsƒ±n
    await setDoc(ref, { resetVersion: next, updatedAt: serverTimestamp() }, { merge:true });
  }

  async function saveScoreToFirebase(){
    if(!cloudReady || !db) { toast("Kayƒ±t yok: Firebase"); return; }
    if(!navigator.onLine) { toast("ƒ∞nternet yok: kayƒ±t yapƒ±lmadƒ±"); return; }

    const { collection, addDoc, serverTimestamp } = fs;

    const payload = {
      name: S.player,
      score: S.score,
      timeSec: S.timeSec,
      mode: S.mode,
      resetVersion: S.resetVersion,
      createdAt: serverTimestamp()
    };

    try{
      await addDoc(collection(db, "leaderboard"), payload);
      toast("Kaydedildi ‚úÖ");
    }catch(err){
      console.warn(err);
      toast("Kayƒ±t hatasƒ±: " + (err?.code || "hata"));
    }
  }

  function fmtTime(sec){
    sec = Math.max(0, Math.floor(sec||0));
    if(sec < 60) return `${sec}s`;
    const m = Math.floor(sec/60);
    const s = sec%60;
    return `${m}dk ${s}s`;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  async function renderLeaderboard(){
    const body = $("lbBody");
    body.innerHTML = `<tr><td colspan="4" style="color:var(--muted);">Y√ºkleniyor...</td></tr>`;

    if(!cloudReady || !db){
      body.innerHTML = `<tr><td colspan="4" style="color:var(--muted);">Firebase baƒülantƒ±sƒ± yok.</td></tr>`;
      return;
    }

    const { collection, query, where, orderBy, limit, getDocs } = fs;

    try{
      // Not: Bu sorgu i√ßin Firestore index isteyebilir.
      // Eƒüer index isterse konsolda link √ßƒ±kar: "Create index" ile 1 kere olu≈üturulur.
      const q = query(
        collection(db, "leaderboard"),
        where("mode","==", S.lbMode),
        where("resetVersion","==", S.resetVersion),
        orderBy("score","desc"),
        orderBy("timeSec","asc"),
        limit(20)
      );

      const snap = await getDocs(q);
      if(snap.empty){
        body.innerHTML = `<tr><td colspan="4" style="color:var(--muted);">Hen√ºz veri yok.</td></tr>`;
        return;
      }

      let i=0;
      body.innerHTML = "";
      snap.forEach(docu=>{
        const d = docu.data();
        i++;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i}</td>
          <td>${escapeHtml(d.name ?? "")}</td>
          <td class="right">${Number(d.score ?? 0)}</td>
          <td class="right">${fmtTime(Number(d.timeSec ?? 0))}</td>
        `;
        body.appendChild(tr);
      });

    }catch(err){
      console.warn(err);
      const code = err?.code || "hata";
      body.innerHTML = `<tr><td colspan="4" style="color:var(--muted);">Okuma hatasƒ±: ${escapeHtml(code)}</td></tr>`;
      toast("Skor okuma: " + code);
    }
  }

  function enableMobileResetGesture(){
    const el = $("teacherReset");
    if(!el) return;
    let t=null;

    const start = ()=>{
      t = setTimeout(async ()=>{
        const ok = confirm("Skor tablosu sƒ±fƒ±rlansƒ±n mƒ±?");
        if(!ok) return;
        try{
          await cloudResetAll();
          toast("Sƒ±fƒ±rlandƒ± ‚úÖ");
        }catch(err){
          console.warn(err);
          toast("Sƒ±fƒ±rlama: " + (err?.code || "hata"));
        }
      }, 6000);
    };
    const cancel = ()=>{ if(t) clearTimeout(t); t=null; };

    el.addEventListener("touchstart", start, {passive:true});
    el.addEventListener("touchend", cancel);
    el.addEventListener("touchcancel", cancel);
    
    // PC i√ßin de click
    el.addEventListener("mousedown", start);
    el.addEventListener("mouseup", cancel);
    el.addEventListener("mouseleave", cancel);
  }

  // Ba≈ülat
  setBadges();
  initFirebase();
  
  // Sayfa y√ºklendiƒüinde audio kontrolleri hazƒ±rla
  document.addEventListener("DOMContentLoaded", function() {
    // Mobil cihaz kontrol√º
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if (isMobile) {
      console.log("Mobil cihaz tespit edildi - Ses i√ßin '‚ñ∂Ô∏è Ba≈ülat' butonunu kullanƒ±n");
    }
  });
</script>
</body>
</html>